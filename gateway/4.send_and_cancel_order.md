

# 下单

vnpy: 同步 def send_order(self, req: OrderRequest) -> str

| 柜台      | 是否同步   | 返回结果集    |
| --------- | --------- | ------------ |
| 恒生O32   | 同步      | 是            |
| 金证      | 同步或异步 | 否/是(收费版) |
| 根网      | 同步或异步 | 否            |

## 金证

- 做市报价(异步)

```
2.2.8 做市交易报价
[函数原型]
/**
* 做市交易报单
* @param[in] pQuoteInfo 报价信息
* @return return 0: 成功，其它：错误码
*/
	int Quote(QUOTE_INFO * pQuoteInfo);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
pQuoteInfo	报价信息	注1	输入参数	是

注1： 报价信息结构体定义
结构体成员	含义	说明	是否必填
szStkCode	证券代码		是
dAskPrice	叫卖价格	非豁免时需大于0,且买卖价不能大于5%	是
nAskVolume	叫卖数量	1000的整数倍	是
dBidPrice	叫买价格	非豁免时需大于0	是
nBidVolume	叫买数量	1000的整数倍	是

[返回值]
0表示成功，非0表示失败
[示例] 	
	QUOTE_INFO quoteInfo;
	memset(&quoteInfo, 0, sizeof(QUOTE_INFO));
	quoteInfo.dAskPrice = m_dAskPrice;
 quoteInfo.dBidPrice = m_dBidPrice;
	quoteInfo.nAskVolume = m_nAskVolume;
	quoteInfo.nBidVolume = m_nBidVolume;
	strcpy_s(quoteInfo.szStkCode, m_pCodeInfo[nData].szStkCode);
  m_pLBMPlugin->Quote(&quoteInfo);

调用前需设置做市交易报价回调函数，才能在回调函数中获取异步请求返回的数据，函数原型：
/**
* 设置做市报价回调函数
* @param[in] hWnd句柄
* @param[in] pQuoteFun 做市股票报价回调函数
*/
	void SetCallBackQuote(HWND hWnd, CALLBACK_QUOTE pQuoteFun);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
hWnd	窗口句柄		输入参数	是
pQuoteFun	做市股票报价回调函数		输入参数	是
[返回值]
无
[示例]
m_pLBMPlugin->SetCallBackQuote(this->GetSafeHwnd(), OnQuote);

```


- 做市策略报价（异步）

```
2.2.9 做市交易策略报价
[函数原型]
/**
	* 做市策略交易报单
	* @param[in] pAlgoQuoteInfo 报价信息
	* @return return 0: 成功，其它：错误码
	*/
	int AlgoQuote(ALGOQUOTE_INFO * pAlgoQuoteInfo);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
pQuoteInfo	报价信息	注1	输入参数	是

注1： 报价信息结构体定义
结构体成员	含义	说明	是否必填
szStkCode	证券代码		是
dAskPrice	叫卖价格	非豁免时需大于0,且买卖价不能大于5%	是
nAskVolume	叫卖数量	1000的整数倍	是
dBidPrice	叫买价格	非豁免时需大于0	是
nBidVolume	叫买数量	1000的整数倍	是
nAlgoID	策略ID		是
szUserDefine	用户自定义文本	用于异步回调时，标注是哪笔委托	否


[返回值]
0表示成功，非0表示失败
[示例] 		
ALGOQUOTE_INFO AlgoQuoteInfo = {0};
AlgoQuoteInfo.dAskPrice = m_dAskPrice;				AlgoQuoteInfo.dBidPrice = m_dBidPrice;
	AlgoQuoteInfo.nAskVolume = m_nAskVolume;
	AlgoQuoteInfo.nBidVolume = m_nBidVolume;
	strcpy_s(AlgoQuoteInfo.szStkCode, m_pCodeInfo[nData].szStkCode);
	strcpy_s(AlgoQuoteInfo.szUserDefine, "UserTest");
	lgoQuoteInfo.nAlgoID = atoi(m_csAlgoID.GetBuffer());
  m_pLBMPlugin->AlgoQuote(&AlgoQuoteInfo);

调用前需设置做市交易报价回调函数，才能在回调函数中获取异步请求返回的数据，具体说明2.2.8中有介绍

```

- 做市报价(同步)

```
[函数原型]
//**
  *做市委托(普通做市)
  * @param[in] pstStkMmOrder 委托信息 - szTrdacct，szStkCode，dBidPrice，llBidWtVolume，dAskPrice，llAskWtVolume
  * @param[out] pstStkMmOrder 委托信息 返回合同序号
  * @return 调用LBM成功或失败
  */
  int MmQuote(STK_MM_ORDER_S* pstStkMmOrder); 
[参数]
参数	参数含义	参数说明	参数类型	是否必填
pstStkMmOrder	委托数据结构体	其中szTrdacct，szStkCode，dBidPrice，llBidWtVolume，dAskPrice，llAskWtVolume必填	输入、输出参数	是

[返回值]
0表示成功，非0表示失败
[示例]  
  int iRet = m_pLBM->MmQuote(&stMmOrder);
  if (iRet != RTMSG_OK)
  {
    strCode = m_pLBM->GetLastError(1);
    AfxMessageBox(strCode);
  }
  else
  {
    char szBuf[256] = { 0 };
    sprintf(szBuf, "报单成功： 合同号 = %s", stMmOrder.szOrderId);
    AfxMessageBox(szBuf);
}

```

- 混合做市报价(异步)

```
[函数原型]
  /**
  *做市委托(普通做市)
  * @param[in] pstStkMmOrder 委托信息 - iAssetId，szStkCode，dOrderPrice，llWtVolume，iStkBiz，szTrdacct
  * @param[out] pstStkMmOrder 委托信息 返回合同序号
  * @return 调用LBM成功或失败
  */
   int AsyncJxMmQuote(STK_JXMM_ORDER_S* pstStkJxMmOrder); 
[参数]
参数	参数含义	参数说明	参数类型	是否必填
pstStkJxMmOrder	委托信息	入参：iAssetId，szStkCode，dOrderPrice，llWtVolume，iStkBiz，szTrdacct必填
	输入参数	是

/** 自营股票报价入参 */
struct NQWTQUOTE_INFO
{
  int nAssetID;                    //!< 资产单元ID
  char szStkCode[8 + 1];           //!< 证券代码
  char chStkEx[1 + 1];             //!< 证券交易所
  int nStkBiz;                     //!< 证券业务
  short nStkBizAction;             //!< 证券业务行为
  double dWtPrice;                 //!< 委托价格
  int nWtVolume;                   //!< 委托数量
  char szTargetTaAcct[6 + 1];      //!< 对手方交易单元
  char szTargetTransAcct[10 + 1];  //!< 对手方证券帐户
  __int64 nAgreementID;            //!< 成交约定号
  char szOrderRemark[64];          //!< 委托备注
  char szUserDefine[16 + 1];       //!< 用户自定义
};



struct STK_JXMM_ORDER_S
{
  long long llQryPos;                         //定位串
  int iIntOrg;                                //内部机构
  int iAssetId;                               //资产单元ID
  char chStkex;                               //证券交易所
  int iOrderSn;                               //委托序号
  int iOrderBsn;                              //委托批号
  char szOrderId[LEN_ORDER_ID];               //合同序号
  int iStkBiz;                                //交易类别
  char szTrdacct[LEN_TRDACCT];                //证券账号
  char szStkCode[LEN_STK_CODE];               //证券代码
  char szStkName[LEN_STK_NAME];               //证券名称
  char chBidOrderStatus;                      //买委托状态
  double dOrderPrice;                         //委托价格
  long long llWtVolume;                       //委托数量
  long long llMatchedVol;                     //成交数量
  double dMatchedAmt;                         //成交金额
  double dMatchedPrice;                       //成交价格
  long long llCancelVol;                      //撤单数量
  int iOrderTime;                             //申报时间
  char szCancleReason[LEN_CANCLE_REMARK];     //废单原因
  char szUserDefine[LEN_USER_DEFINE];      // 用户自定义
  int iAlgoId;                               // 策略ID
};

[返回值]
0表示成功，非0表示失败
[示例]  
  int iRet = m_pLBM->JxMmQuote(&stMmOrder);
  if (iRet != RTMSG_OK)
  {
    strCode = m_pLBM->GetLastError(1);
    AfxMessageBox(strCode);
  }

调用前需设置回调函数，才能在回调函数中获取异步请求返回的数据，本接口与“自营交易报价”共用一个回调函数
函数原型：
	void SetCallBackNQWTQuote(HWND hWnd, CALLBACK_NQWTQUOTE pQuoteFun);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
hWnd	窗口句柄		输入参数	是
pQuoteFun	自营股票报价回调函数		输入参数	是
[返回值]
无
[示例]
m_pLBMPlugin->SetCallBackNQWTQuote(this->GetSafeHwnd(), OnNQWTQuote);


```


- 自营交易报价（异步）

```
[函数原型]
/**
* 自营交易报价
* @param[in] pQuoteInfo 报价信息
* @return return 0: 成功，其它：错误码
*/
	int NQWTQuote(NQWTQUOTE_INFO * pQuoteInfo);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
pQuoteInfo	报价信息	注1	输入参数	是

注1： 报价信息结构体定义
结构体成员	含义	说明	是否必填
nAssetID	资产单元ID	证券代码所属的资产单元	否
szStkCode	证券代码		是
nStkBiz	证券业务	参考第一章QUOTE_MATCH_INFO.nStkBiz	是
dWtPrice	委托价格	必须大于0	是
nWtVolume	委托数量	1000的整数倍	是
szTargetTaAcct	对手方交易单元		否
szTargetTransAcct	对手方证券帐户		否
nAgreementID	成交约定号		否
szOrderRemark	委托备注		否

[返回值]
0表示成功，非0表示失败
[示例]  
NQWTQUOTE_INFO QuoteInfo = {0};
strcpy_s(QuoteInfo.szStkCode, m_pCodeInfo[nData].szStkCode);
QuoteInfo.nStkBiz = nNQWTType;
QuoteInfo.dWtPrice = m_dWTPrice;
QuoteInfo.nWtVolume = m_nWTVol;
m_pLBMPlugin->NQWTQuote(&QuoteInfo);

调用前需设置自营交易报价回调函数，才能在回调函数中获取异步请求返回的数据，函数原型：
/**
* 设置自营交易报价回调函数
* @param[in] hWnd句柄
* @param[in] pQuoteFun 自营股票报价回调函数
*/
	void SetCallBackNQWTQuote(HWND hWnd, CALLBACK_NQWTQUOTE pQuoteFun);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
hWnd	窗口句柄		输入参数	是
pQuoteFun	自营股票报价回调函数		输入参数	是
[返回值]
无
[示例]
m_pLBMPlugin->SetCallBackNQWTQuote(this->GetSafeHwnd(), OnNQWTQuote);
```

- 集合竞价和大宗交易报价(异步)

```
[函数原型]
/**
* 自营交易报价
* @param[in] pQuoteInfo 报价信息
* @return return 0: 成功，其它：错误码
*/
	int DZQuote(DZQUOTE_INFO * pQuoteInfo);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
pQuoteInfo	报价信息	注1	输入参数	是

注1： 报价信息结构体定义
结构体成员	含义	说明	是否必填
nAssetID	资产单元ID	证券代码所属的资产单元	否
szStkCode	证券代码		是
nStkBiz	证券业务	参考第一章QUOTE_MATCH_INFO.nStkBiz	是
dWtPrice	委托价格	必须大于0	是
nWtVolume	委托数量	1000的整数倍	是
szTargetTaAcct	对手方交易单元		否
szTargetTransAcct	对手方证券帐户		否
nAgreementID	成交约定号		否
szOrderRemark	委托备注		否
chDZFlag	大宗交易标识		是

[返回值]
0表示成功，非0表示失败
[示例]  
DZQUOTE_INFO QuoteInfo = {0};
QuoteInfo.chDZFlag[0] = '1';// '1'为大宗交易标识
strcpy_s(QuoteInfo.szStkCode, m_pCodeInfo[nData].szStkCode);
QuoteInfo.nStkBiz = nNQWTType;// nNQWTType的取值参考算法API示例代码
QuoteInfo.dWtPrice = m_dWTPrice;
QuoteInfo.nWtVolume = m_nWTVol;
m_pLBMPlugin->NQWTQuote(&QuoteInfo);

调用前需设置自营交易报价回调函数，才能在回调函数中获取异步请求返回的数据，函数原型：
/**
* 设置自营交易报价回调函数
* @param[in] hWnd句柄
* @param[in] pQuoteFun 自营股票报价回调函数
*/
	void SetCallBackNQWTQuote(HWND hWnd, CALLBACK_NQWTQUOTE pQuoteFun);
[参数]
参数	参数含义	参数说明	参数类型	是否必填
hWnd	窗口句柄		输入参数	是
pQuoteFun	自营股票报价回调函数		输入参数	是
[返回值]
无
[示例]
m_pLBMPlugin->SetCallBackNQWTQuote(this->GetSafeHwnd(), OnNQWTQuote);

```
